{{define "content"}}
<div class="viewer-layout" data-version-id="{{.VersionID}}" data-project-id="{{.ProjectID}}">
    <header class="viewer-header">
        <a href="/" class="viewer-back">&larr; Projects</a>
        <h1 class="viewer-title">{{.ProjectName}}</h1>
        <select id="status-select" class="status-select badge badge-{{.Status}}">
            <option value="draft"{{if eq .Status "draft"}} selected{{end}}>Draft</option>
            <option value="in_review"{{if eq .Status "in_review"}} selected{{end}}>In Review</option>
            <option value="approved"{{if eq .Status "approved"}} selected{{end}}>Approved</option>
            <option value="handed_off"{{if eq .Status "handed_off"}} selected{{end}}>Handed Off</option>
        </select>
        <div class="viewport-switcher">
            <button class="viewport-btn active" data-width="1080">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256"><path d="M208,40H48A24,24,0,0,0,24,64V176a24,24,0,0,0,24,24h72v16H96a8,8,0,0,0,0,16h64a8,8,0,0,0,0-16H136V200h72a24,24,0,0,0,24-24V64A24,24,0,0,0,208,40ZM192,176H64V64H192Z"></path></svg>
                Desktop
            </button>
            <button class="viewport-btn" data-width="375">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256"><path d="M176,16H80A24,24,0,0,0,56,40V216a24,24,0,0,0,24,24h96a24,24,0,0,0,24-24V40A24,24,0,0,0,176,16ZM80,56h96V200H80Z"></path></svg>
                Mobile
            </button>
        </div>
        {{if .IsOwner}}<button id="share-btn" class="btn-share" title="Share project">Share</button>{{end}}
    </header>
    <div class="viewer-body">
        <main class="viewer-main">
            <div class="page-tabs" id="page-tabs">
                <button class="page-tab" data-page="__flow__">Flow</button>
                {{range .Pages}}
                <button class="page-tab{{if eq . $.DefaultPage}} active{{end}}" data-page="{{.}}">{{.}}</button>
                {{end}}
            </div>
            <div id="flow-graph"></div>
            <div class="iframe-wrapper">
                <div class="design-container">
                    <div class="design-frame">
                        <div id="pin-overlay"></div>
                        <iframe
                            id="design-frame"
                            class="viewer-iframe"
                            src="/designs/{{.VersionID}}/{{.DefaultPage}}"
                            sandbox="allow-same-origin allow-scripts"
                        ></iframe>
                    </div>
                </div>
                <div class="mode-switcher-floating">
                    <button class="mode-btn-floating active" data-mode="view">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 256 256"><path d="M247.31,124.76c-.35-.79-8.82-19.58-27.65-38.41C194.57,61.26,162.88,48,128,48S61.43,61.26,36.34,86.35C17.51,105.18,9,124,8.69,124.76a8,8,0,0,0,0,6.5c.35.79,8.82,19.57,27.65,38.4C61.43,194.74,93.12,208,128,208s66.57-13.26,91.66-38.34c18.83-18.83,27.3-37.61,27.65-38.4A8,8,0,0,0,247.31,124.76ZM128,192c-30.78,0-57.67-11.19-79.93-33.25A133.47,133.47,0,0,1,25,128,133.33,133.33,0,0,1,48.07,97.25C70.33,75.19,97.22,64,128,64s57.67,11.19,79.93,33.25A133.46,133.46,0,0,1,231.05,128C223.84,141.46,192.43,192,128,192Zm0-112a48,48,0,1,0,48,48A48.05,48.05,0,0,0,128,80Zm0,80a32,32,0,1,1,32-32A32,32,0,0,1,128,160Z"></path></svg>
                        <span class="mode-label">View</span>
                        <span class="mode-tooltip">View V</span>
                    </button>
                    <button class="mode-btn-floating" data-mode="comment">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 256 256"><path d="M128,24A104,104,0,0,0,36.18,176.88L24.83,210.93a16,16,0,0,0,20.24,20.24l34.05-11.35A104,104,0,1,0,128,24Zm0,192a87.87,87.87,0,0,1-44.06-11.81,8,8,0,0,0-6.54-.67L40,216,52.47,178.6a8,8,0,0,0-.66-6.54A88,88,0,1,1,128,216Z"></path></svg>
                        <span class="mode-label">Comment</span>
                        <span class="mode-tooltip">Comment C</span>
                    </button>
                </div>
            </div>
        </main>
        <aside id="right-sidebar" class="right-sidebar open">
            <div id="versions-panel" class="sidebar-panel active">
                <div class="sidebar-section">
                    <h3>Versions</h3>
                    <div id="version-list"></div>
                </div>
            </div>
            <div id="comments-panel-sidebar" class="sidebar-panel">
                <div class="sidebar-section">
                    <h3>Comments</h3>
                    <div id="annotation-filter" class="comment-filters">
                        <button class="filter-btn active" data-filter="all">All</button>
                        <button class="filter-btn" data-filter="open">Open</button>
                        <button class="filter-btn" data-filter="resolved">Resolved</button>
                    </div>
                </div>
                <div id="comments-sidebar-list"></div>
            </div>
        </aside>
    </div>
</div>
<div id="comment-panel-backdrop" class="comment-panel-backdrop">
    <div id="comment-panel"></div>
</div>
<div id="share-dialog" style="display:none" class="share-dialog">
    <div class="share-dialog-content">
        <h3>Share Project</h3>
        <button id="generate-invite" class="btn-primary">Generate Invite Link</button>
        <div id="invite-link-box" style="display:none">
            <input id="invite-link" type="text" readonly class="invite-link-input">
            <button id="copy-invite" class="btn-copy">Copy</button>
        </div>
        <h4>Members</h4>
        <div id="members-list"></div>
        <button id="close-share" class="btn-secondary">Close</button>
    </div>
</div>
<script>
    window.authUser = {{if .UserName}}{name: "{{.UserName}}"}{{else}}null{{end}};
    window.isOwner = {{.IsOwner}};
</script>
<script src="/static/vendor/cytoscape.min.js"></script>
<script src="/static/vendor/dagre.min.js"></script>
<script src="/static/vendor/cytoscape-dagre.min.js"></script>
<script src="/static/flow.js"></script>
<script src="/static/viewer.js"></script>
<script src="/static/annotations.js"></script>
<script src="/static/sharing.js"></script>
{{end}}
